<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turquoise Breathing Light - Algorithmic Art</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            color: #2c3e50;
            overflow-x: hidden;
        }

        .container {
            display: grid;
            grid-template-columns: 320px 1fr;
            min-height: 100vh;
        }

        .sidebar {
            background: white;
            padding: 2rem;
            box-shadow: 2px 0 12px rgba(0,0,0,0.08);
            overflow-y: auto;
            max-height: 100vh;
        }

        h1 {
            font-family: 'Lora', serif;
            font-size: 1.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #1a1a1a;
            line-height: 1.3;
        }

        .subtitle {
            font-size: 0.875rem;
            color: #6c757d;
            margin-bottom: 2rem;
            font-weight: 300;
        }

        .section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: #6c757d;
            margin-bottom: 1rem;
            font-weight: 500;
        }

        .control-group {
            margin-bottom: 1.25rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            margin-bottom: 0.5rem;
            color: #495057;
            font-weight: 400;
        }

        input[type="range"] {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e9ecef;
            outline: none;
            -webkit-appearance: none;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        input[type="range"]::-moz-range-thumb {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
            border: none;
        }

        .value-display {
            display: inline-block;
            font-size: 0.875rem;
            color: #6c757d;
            font-weight: 500;
            margin-top: 0.25rem;
        }

        input[type="color"] {
            width: 100%;
            height: 40px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
        }

        .seed-controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .seed-display {
            grid-column: 1 / -1;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-size: 1.5rem;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .jump-control {
            grid-column: 1 / -1;
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .jump-control input {
            flex: 1;
            padding: 0.5rem;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.875rem;
        }

        button {
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 6px;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: white;
            color: #495057;
            border: 2px solid #e9ecef;
        }

        .btn-secondary:hover {
            background: #f8f9fa;
            border-color: #dee2e6;
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .canvas-container {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }

        canvas {
            box-shadow: 0 8px 32px rgba(0,0,0,0.12);
            border-radius: 8px;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }

            .sidebar {
                max-height: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="sidebar">
            <h1>Turquoise Breathing Light</h1>
            <p class="subtitle">Serene stone luminescence through layered noise fields and color temperature physics</p>

            <!-- SEED SECTION -->
            <div class="section">
                <div class="section-title">Seed</div>
                <div class="seed-display" id="seed-display">12345</div>
                <div class="seed-controls">
                    <button class="btn-secondary" onclick="prevSeed()">‚Üê Prev</button>
                    <button class="btn-secondary" onclick="randomSeed()">üé≤ Random</button>
                    <button class="btn-secondary" onclick="nextSeed()">Next ‚Üí</button>
                </div>
                <div class="jump-control">
                    <input type="number" id="jump-seed" placeholder="Jump to seed...">
                    <button class="btn-primary" onclick="jumpToSeed()">Go</button>
                </div>
            </div>

            <!-- PARAMETERS SECTION -->
            <div class="section">
                <div class="section-title">Parameters</div>

                <div class="control-group">
                    <label>Breath Cycle Duration (seconds)</label>
                    <input type="range" id="breathDuration" min="20" max="80" step="1" value="42" oninput="updateParam('breathDuration', this.value)">
                    <span class="value-display" id="breathDuration-value">42s</span>
                </div>

                <div class="control-group">
                    <label>Light Pool Count</label>
                    <input type="range" id="poolCount" min="2" max="8" step="1" value="4" oninput="updateParam('poolCount', this.value)">
                    <span class="value-display" id="poolCount-value">4</span>
                </div>

                <div class="control-group">
                    <label>Noise Complexity</label>
                    <input type="range" id="noiseOctaves" min="2" max="6" step="1" value="4" oninput="updateParam('noiseOctaves', this.value)">
                    <span class="value-display" id="noiseOctaves-value">4 octaves</span>
                </div>

                <div class="control-group">
                    <label>Color Temperature Range</label>
                    <input type="range" id="colorTemp" min="0.3" max="1.0" step="0.05" value="0.7" oninput="updateParam('colorTemp', this.value)">
                    <span class="value-display" id="colorTemp-value">0.70</span>
                </div>

                <div class="control-group">
                    <label>Luminance Intensity</label>
                    <input type="range" id="intensity" min="0.4" max="1.2" step="0.05" value="0.8" oninput="updateParam('intensity', this.value)">
                    <span class="value-display" id="intensity-value">0.80</span>
                </div>

                <div class="control-group">
                    <label>Drift Speed</label>
                    <input type="range" id="driftSpeed" min="0.1" max="2.0" step="0.1" value="0.5" oninput="updateParam('driftSpeed', this.value)">
                    <span class="value-display" id="driftSpeed-value">0.5x</span>
                </div>
            </div>

            <!-- COLORS SECTION -->
            <div class="section">
                <div class="section-title">Colors</div>

                <div class="control-group">
                    <label>Cyan Highlight</label>
                    <input type="color" id="cyanColor" value="#5ffff5" onchange="updateColor('cyanColor', this.value)">
                </div>

                <div class="control-group">
                    <label>Base Turquoise</label>
                    <input type="color" id="baseColor" value="#03d3b1" onchange="updateColor('baseColor', this.value)">
                </div>

                <div class="control-group">
                    <label>Teal Depth</label>
                    <input type="color" id="tealColor" value="#029d86" onchange="updateColor('tealColor', this.value)">
                </div>
            </div>

            <!-- ACTIONS SECTION -->
            <div class="section">
                <div class="section-title">Actions</div>
                <div class="actions">
                    <button class="btn-primary" onclick="regenerate()">üîÑ Regenerate</button>
                    <button class="btn-secondary" onclick="resetParams()">‚Ü∫ Reset Parameters</button>
                    <button class="btn-secondary" onclick="downloadImage()">üíæ Download PNG</button>
                </div>
            </div>
        </div>

        <div class="canvas-container" id="canvas-container"></div>
    </div>

    <script>
        // PARAMETERS
        let params = {
            seed: 12345,
            breathDuration: 42,
            poolCount: 4,
            noiseOctaves: 4,
            colorTemp: 0.7,
            intensity: 0.8,
            driftSpeed: 0.5,
            cyanColor: '#5ffff5',
            baseColor: '#03d3b1',
            tealColor: '#029d86'
        };

        const defaults = {...params};

        // LIGHT POOLS
        class LightPool {
            constructor(x, y, size, phase, speed) {
                this.baseX = x;
                this.baseY = y;
                this.x = x;
                this.y = y;
                this.size = size;
                this.phase = phase;
                this.speed = speed;
                this.noiseOffsetX = random(1000);
                this.noiseOffsetY = random(1000);
            }

            update(time) {
                // Layered Perlin noise for organic drift
                let noiseX = noise(this.noiseOffsetX + time * this.speed * 0.0003) - 0.5;
                let noiseY = noise(this.noiseOffsetY + time * this.speed * 0.0003) - 0.5;

                this.x = this.baseX + noiseX * 150;
                this.y = this.baseY + noiseY * 150;
            }

            getIntensity(px, py, time) {
                let d = dist(px, py, this.x, this.y);

                // Breathing pulse using asymmetric timing
                let breathCycle = params.breathDuration * 1000;
                let t = (time + this.phase * breathCycle) % breathCycle / breathCycle;
                let breath;
                if (t < 0.38) {
                    breath = map(t, 0, 0.38, 0.6, 1.0);
                } else if (t < 0.72) {
                    breath = map(t, 0.38, 0.72, 1.0, 0.5);
                } else {
                    breath = map(t, 0.72, 1.0, 0.5, 0.6);
                }

                // Gaussian falloff
                let intensity = breath * exp(-pow(d / this.size, 2) * 2);
                return intensity;
            }
        }

        let lightPools = [];
        let startTime;

        function setup() {
            let canvas = createCanvas(1200, 1200);
            canvas.parent('canvas-container');

            colorMode(RGB, 255);
            noStroke();

            initializeArt();
        }

        function initializeArt() {
            randomSeed(params.seed);
            noiseSeed(params.seed);

            startTime = millis();
            lightPools = [];

            // Create light pools at compositionally significant positions
            for (let i = 0; i < params.poolCount; i++) {
                let angle = (i / params.poolCount) * TWO_PI + random(-0.3, 0.3);
                let radius = width * (0.2 + random(0.15));
                let x = width/2 + cos(angle) * radius;
                let y = height/2 + sin(angle) * radius;
                let size = random(250, 450);
                let phase = random(1.0);
                let speed = params.driftSpeed * random(0.8, 1.2);

                lightPools.push(new LightPool(x, y, size, phase, speed));
            }
        }

        function draw() {
            let time = millis() - startTime;

            // Update light pools
            for (let pool of lightPools) {
                pool.update(time);
            }

            // Parse colors
            let cyan = hexToRgb(params.cyanColor);
            let base = hexToRgb(params.baseColor);
            let teal = hexToRgb(params.tealColor);

            // Render pixel by pixel with layered noise
            loadPixels();

            let resolution = 3; // Optimize: render at lower res for speed
            for (let y = 0; y < height; y += resolution) {
                for (let x = 0; x < width; x += resolution) {
                    // Accumulate light from all pools
                    let totalIntensity = 0;
                    for (let pool of lightPools) {
                        totalIntensity += pool.getIntensity(x, y, time);
                    }

                    // Add layered Perlin noise for micro-variations
                    let noiseVal = 0;
                    for (let octave = 0; octave < params.noiseOctaves; octave++) {
                        let freq = pow(2, octave) * 0.002;
                        let amp = pow(0.5, octave);
                        noiseVal += noise(x * freq, y * freq, time * 0.0001 * params.driftSpeed) * amp;
                    }

                    totalIntensity = totalIntensity * params.intensity + noiseVal * 0.15;
                    totalIntensity = constrain(totalIntensity, 0, 1);

                    // Color temperature interpolation
                    // High intensity ‚Üí cyan highlights
                    // Medium ‚Üí base turquoise
                    // Low ‚Üí teal depths
                    let r, g, b;
                    if (totalIntensity > 0.6) {
                        let t = map(totalIntensity, 0.6, 1.0, 0, 1);
                        t = pow(t, params.colorTemp); // Non-linear curve
                        r = lerp(base.r, cyan.r, t);
                        g = lerp(base.g, cyan.g, t);
                        b = lerp(base.b, cyan.b, t);
                    } else {
                        let t = map(totalIntensity, 0, 0.6, 0, 1);
                        t = pow(t, 1.0 / params.colorTemp);
                        r = lerp(teal.r, base.r, t);
                        g = lerp(teal.g, base.g, t);
                        b = lerp(teal.b, base.b, t);
                    }

                    // Fill pixel block
                    for (let dy = 0; dy < resolution; dy++) {
                        for (let dx = 0; dx < resolution; dx++) {
                            let px = x + dx;
                            let py = y + dy;
                            if (px < width && py < height) {
                                let index = (px + py * width) * 4;
                                pixels[index] = r;
                                pixels[index + 1] = g;
                                pixels[index + 2] = b;
                                pixels[index + 3] = 255;
                            }
                        }
                    }
                }
            }

            updatePixels();
        }

        // UTILITY FUNCTIONS
        function hexToRgb(hex) {
            let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : {r: 0, g: 0, b: 0};
        }

        // UI HANDLERS
        function updateParam(name, value) {
            params[name] = parseFloat(value);

            // Update display
            let display = document.getElementById(name + '-value');
            if (name === 'breathDuration') {
                display.textContent = value + 's';
            } else if (name === 'noiseOctaves' || name === 'poolCount') {
                display.textContent = value + (name === 'noiseOctaves' ? ' octaves' : '');
            } else if (name === 'driftSpeed') {
                display.textContent = value + 'x';
            } else {
                display.textContent = parseFloat(value).toFixed(2);
            }

            if (name === 'poolCount') {
                initializeArt();
            }
        }

        function updateColor(name, value) {
            params[name] = value;
        }

        function prevSeed() {
            params.seed--;
            updateSeedDisplay();
            initializeArt();
        }

        function nextSeed() {
            params.seed++;
            updateSeedDisplay();
            initializeArt();
        }

        function randomSeed() {
            params.seed = floor(random(1, 999999));
            updateSeedDisplay();
            initializeArt();
        }

        function jumpToSeed() {
            let input = document.getElementById('jump-seed');
            let newSeed = parseInt(input.value);
            if (!isNaN(newSeed)) {
                params.seed = newSeed;
                updateSeedDisplay();
                initializeArt();
                input.value = '';
            }
        }

        function updateSeedDisplay() {
            document.getElementById('seed-display').textContent = params.seed;
        }

        function regenerate() {
            initializeArt();
        }

        function resetParams() {
            params = {...defaults};

            // Update all UI controls
            document.getElementById('breathDuration').value = params.breathDuration;
            document.getElementById('poolCount').value = params.poolCount;
            document.getElementById('noiseOctaves').value = params.noiseOctaves;
            document.getElementById('colorTemp').value = params.colorTemp;
            document.getElementById('intensity').value = params.intensity;
            document.getElementById('driftSpeed').value = params.driftSpeed;
            document.getElementById('cyanColor').value = params.cyanColor;
            document.getElementById('baseColor').value = params.baseColor;
            document.getElementById('tealColor').value = params.tealColor;

            // Update displays
            updateParam('breathDuration', params.breathDuration);
            updateParam('poolCount', params.poolCount);
            updateParam('noiseOctaves', params.noiseOctaves);
            updateParam('colorTemp', params.colorTemp);
            updateParam('intensity', params.intensity);
            updateParam('driftSpeed', params.driftSpeed);

            updateSeedDisplay();
            initializeArt();
        }

        function downloadImage() {
            saveCanvas('turquoise-breathing-light-' + params.seed, 'png');
        }
    </script>
</body>
</html>
